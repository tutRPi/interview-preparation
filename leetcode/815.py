import math


class Solution:
    def numBusesToDestination(self, routes, source: int, target: int) -> int:
        if source == target:
            return 0

        change_of_lines = math.inf

        lines = self.find_lines_of_bus_stop(routes, source)
        for line in lines:
            change_of_lines = min(change_of_lines,
                                  self.count_change_of_lines(routes, [], line, target))

        if change_of_lines == math.inf:
            return -1
        return change_of_lines

    def count_change_of_lines(self, routes, visited_lines, source_line, target_bus_stop) -> int:
        if source_line in visited_lines:
            return math.inf

        if target_bus_stop in routes[source_line]:
            return 1

        visited_lines.append(source_line)

        change_of_lines = [math.inf]
        for bus_stop in routes[source_line]:
            lines = self.find_lines_of_bus_stop(routes, bus_stop)
            for line in lines:
                if line != source_line and line not in visited_lines:
                    change_of_lines.append(self.count_change_of_lines(routes, visited_lines, line, target_bus_stop))
        return 1 + min(change_of_lines)

    def find_lines_of_bus_stop(self, routes, bus_stop):
        lines = []
        for i in range(len(routes)):
            if bus_stop in routes[i]:
                lines.append(i)
        return lines


if __name__ == "__main__":
    assert Solution().numBusesToDestination(
        [[0, 1, 6, 16, 22, 23], [14, 15, 24, 32], [4, 10, 12, 20, 24, 28, 33], [1, 10, 11, 19, 27, 33],
         [11, 23, 25, 28], [15, 20, 21, 23, 29], [29]], 4, 21) == 2

    Solution().numBusesToDestination([[16,18,24,75,82,83,93,95,98,103,106,168,171,211,218,221,265,283,285,307,313,319,336,369,377,379,390,392,397,423,452,457],[4,21,25,28,29,46,48,53,54,71,81,86,116,117,122,124,130,133,147,148,151,155,158,171,198,208,209,218,248,252,261,267,271,273,274,275,288,289,291,299,300,301,303,330,334,352,362,364,365,373,381,386,393,421,424,428,431,433,437,458,466,473],[22,32,44,72,90,100,129,132,153,158,161,173,175,187,196,209,213,220,221,236,239,242,268,281,283,289,304,326,330,334,352,365,376,389,414,428,429,443,461],[4,8,9,10,12,19,36,44,45,48,53,59,63,68,76,78,79,82,85,100,102,105,113,121,131,157,163,164,165,175,179,180,192,196,200,210,221,222,225,232,237,245,265,272,275,279,283,300,302,327,331,332,335,348,353,356,363,378,385,387,403,422,428,429,451,452],[6,13,14,36,37,41,42,55,62,78,82,83,96,107,114,116,118,129,138,143,158,164,168,201,202,204,222,223,227,229,232,234,244,265,268,274,289,295,313,317,322,330,341,347,348,361,363,369,379,391,414,433,447,456,464,465],[14,22,36,39,42,57,62,65,70,86,90,97,112,123,133,145,151,158,168,185,187,192,194,203,223,225,234,238,245,252,255,267,271,274,285,297,300,303,318,322,343,344,363,364,372,381,399,419,420,425,426,427,433,439,440,450,452,470,471],[56,74,100,167,179,194,214,250,288,332,393,410,439],[1,5,6,8,10,18,24,27,29,30,36,42,44,52,64,66,70,83,96,97,98,100,103,107,113,125,129,140,141,159,160,163,164,166,172,174,181,186,194,202,208,218,232,239,242,248,258,277,279,284,286,291,295,302,304,305,308,313,316,319,320,341,342,352,356,360,370,386,392,399,400,402,408,410,412,416,427,434,435,439,444,457,463,471,472],[0,1,10,12,26,27,29,30,48,51,60,72,83,84,89,91,100,103,125,127,131,136,147,156,167,170,173,178,181,182,186,188,195,197,201,204,211,215,216,221,235,238,266,269,277,282,287,296,317,335,340,343,347,351,355,357,358,366,368,382,384,390,395,397,404,418,421,424,427,429,430,438,458,462,466],[87,207,419],[9,22,89,90,129,131,136,142,148,154,176,182,204,207,217,228,246,248,275,306,328,340,341,364,366,371,407,418,420,437,439,442,458,473],[2,25,34,67,80,81,106,110,125,146,160,172,176,178,196,205,208,217,226,239,244,253,269,280,300,308,322,324,328,335,340,342,343,352,365,368,385,387,391,404,410,413,416,420,423,433,435,436,439,440,450,468],[10,59,68,75,79,90,91,98,105,121,134,143,145,156,162,174,209,214,216,235,249,255,256,258,260,274,279,291,308,312,315,319,341,346,350,353,356,382,386,399,408,414,435,449,471],[1,5,6,9,14,35,39,41,53,70,75,77,91,98,101,108,114,120,123,134,150,156,160,171,180,181,186,187,201,206,215,220,223,236,248,249,251,255,257,263,269,270,278,282,305,312,313,314,320,327,331,338,345,349,359,360,380,381,384,389,400,414,415,419,420,427,429,432,437,440,441,442,455],[2,12,14,15,51,62,64,69,74,90,97,98,99,100,110,112,114,118,133,136,138,139,154,163,170,172,173,180,194,199,207,210,211,226,233,234,235,260,273,274,282,300,302,314,318,327,334,335,344,351,352,354,367,369,377,385,388,407,419,420,433,434,441,444,445,450,454,458,470],[2,30,32,41,64,71,76,77,79,84,104,109,128,132,137,143,147,152,160,182,191,196,197,204,218,221,262,282,312,323,326,334,349,357,361,371,385,387,398,415,460,461,471],[2,6,28,45,56,68,70,110,113,140,150,159,168,172,174,175,177,179,204,207,230,231,235,247,281,285,289,291,298,315,322,326,339,350,351,352,367,369,376,380,381,382,386,427,429,443,461,465,470],[47,61,62,63,84,105,107,124,151,178,203,234,239,253,267,304,322,349,353,357,363,365,396,412,425,446,451,462],[10,21,65,109,114,168,200,253,292,308,323,327,381,392,393,432],[17,21,27,30,107,140,191,195,261,278,290,332,342,347,353,399,402,433,444],[46,91,95,103,154,181,192,202,221,224,266,290,335,342,346,347,363,381,394,401,417,439,441],[19,30,39,61,118,197,200,224,271,278,360,408],[15,20,30,37,38,60,65,79,81,88,91,92,93,99,100,101,103,115,124,148,160,191,194,228,234,251,252,258,261,272,280,300,301,303,313,316,318,320,329,343,378,379,380,387,406,412,418,423,435,439,443,470,472],[0,5,12,25,71,86,100,102,132,143,167,181,183,187,226,244,304,336,423,461],[6,20,26,45,48,53,67,73,81,87,89,92,94,96,99,107,122,128,129,137,138,149,159,168,182,202,211,219,225,229,231,234,240,244,247,251,254,261,284,292,297,300,302,305,315,328,337,338,348,354,366,381,382,383,384,395,398,399,409,415,418,420,422,424,426,428,450,452,457,460,461],[4,6,22,39,44,48,49,52,61,64,68,71,76,78,93,101,102,111,114,126,127,138,141,148,159,167,172,176,187,195,201,205,207,232,242,252,256,277,289,295,297,299,301,305,310,320,332,335,339,343,346,350,353,355,364,366,375,380,388,419,420,423,444,446,448,450,453,464,471],[67,68,73,83,152,202,218,222,264,289,301,302,368,371,412,416,435],[8,10,19,32,38,54,64,75,84,114,124,130,139,149,158,160,172,181,185,194,195,200,208,231,240,277,283,292,308,328,335,338,353,355,366,371,390,406,412,418,445,462,469,470,474],[9,22,30,65,81,88,138,142,151,153,155,156,160,162,166,174,181,188,192,198,203,219,238,240,243,252,257,258,265,301,325,330,340,362,370,392,396,399,404,417,447,454,463,467,472,473],[7,15,35,152,165,229,296,330,331,342,348,359,459],[9,12,21,28,35,45,50,57,61,76,83,97,107,111,120,130,165,171,177,180,187,195,199,204,216,217,227,244,262,278,283,285,290,304,305,310,316,329,331,343,354,360,378,387,413,422,427,433,438,449,452,456,465,468,469],[37,109,112,173,174,219,248,249,263,347,396,401,417],[9,13,24,25,34,38,44,47,54,64,70,86,102,103,106,111,112,118,129,136,145,152,159,162,196,207,209,215,224,225,248,257,259,275,315,327,345,355,378,382,394,398,423,429,433,438,445,449,450,462,472],[3,20,28,30,36,47,63,70,78,90,93,101,102,108,111,126,140,150,153,160,162,163,167,170,182,190,195,203,204,210,216,219,229,232,239,247,251,252,253,269,283,291,292,294,295,309,334,343,350,356,364,365,368,372,373,382,393,406,413,418,439,443,446,454,461,463,469,474],[0,1,10,11,18,20,21,22,23,24,33,36,43,54,60,62,65,71,72,76,77,78,80,98,103,106,118,120,124,131,138,140,143,151,155,160,161,164,165,170,171,174,175,186,191,199,207,228,231,239,243,246,248,254,265,267,278,281,286,290,291,298,299,309,312,316,327,348,358,366,371,380,381,396,412,417,422,423,424,430,436,439,442,468],[8,17,19,38,43,54,68,70,79,99,109,112,122,133,153,159,162,179,185,190,199,227,229,239,259,260,267,275,277,278,293,296,324,325,326,332,335,336,342,358,362,385,391,408,419,420,421,422,433,447,451,471],[1,3,6,19,25,27,29,39,45,48,54,59,61,67,68,71,72,73,77,83,105,107,111,113,126,129,131,139,141,154,162,165,167,168,172,173,174,180,182,192,195,200,209,211,213,218,225,228,231,236,242,267,270,272,280,283,284,286,291,297,298,299,302,317,324,333,335,340,347,348,350,354,355,358,366,368,372,373,380,399,419,421,428,435,436,450,455,470],[103,146,194,267,317,351,433,468],[5,11,16,47,49,59,72,79,119,120,127,129,143,158,162,185,204,221,235,248,249,264,270,290,291,295,297,301,313,316,324,334,335,340,377,404,410,412,423,446,456,458,462,464,472],[14,16,53,61,65,86,98,99,100,113,115,185,207,217,246,278,282,336,358,375,429,445],[9,21,33,36,40,49,58,59,66,70,79,81,84,107,112,123,126,133,134,135,141,154,155,169,178,195,210,216,220,231,232,239,255,257,272,279,294,295,300,301,305,308,313,357,372,380,383,386,388,393,414,415,419,420,424,437,443,445,456,466,467],[10,179,182,353],[0,2,6,7,8,13,19,20,28,35,40,42,49,53,59,62,71,75,76,86,95,96,101,115,116,126,129,144,155,157,159,171,191,195,205,215,220,222,224,234,240,241,257,260,264,267,269,280,281,290,307,339,341,346,347,363,377,378,383,389,395,401,405,406,407,416,418,420,426,429,432,434,438,441,459,460,473],[1,10,11,28,30,34,36,41,58,117,149,169,217,218,219,245,270,354,386,440],[3,12,15,19,21,23,30,48,49,63,81,90,110,119,133,141,143,166,168,185,191,200,203,214,222,253,260,266,284,306,311,321,329,340,380,397,399,401,415,425,426,428,437,463],[12,32,34,64,70,80,86,89,91,117,119,125,133,172,187,189,191,197,223,246,259,265,280,282,291,296,346,350,352,368,405,411,430,434,468],[13,57,58,93,100,172,174,182,231,252,269,347,389,417,474],[1,24,28,30,33,52,55,60,61,66,67,71,76,77,79,88,96,101,121,126,129,136,146,152,155,171,175,176,179,190,197,199,200,205,208,221,230,238,245,249,253,257,259,266,269,272,274,276,284,285,294,298,300,319,332,335,345,349,350,353,359,361,362,365,374,377,379,392,413,417,436,441,442,454,457,461,465,471,472],[4,22,30,53,56,57,74,79,80,96,98,100,107,128,133,139,142,151,175,183,190,191,193,206,211,224,230,237,242,245,251,256,261,270,272,275,276,280,286,294,305,317,327,330,334,344,364,385,387,394,398,402,403,404,407,412,413,419,427,428,457,460,461,471],[356,369],[23,46,49,51,53,59,61,74,96,113,114,120,135,138,139,144,159,192,202,204,215,216,236,261,268,281,301,317,324,346,377,380,389,402,414,427,429,459],[20,29,38,39,45,58,77,78,97,102,113,130,139,140,142,154,171,172,188,196,200,211,214,215,224,233,237,246,249,252,256,271,278,280,282,287,296,301,302,304,310,330,340,346,348,360,372,376,377,381,390,396,405,424,427,442,444,451,459,465],[107,154,179,222,252,286,313,316,372,382,383,385],[8,16,27,62,68,69,73,84,103,120,172,177,179,189,207,208,229,240,274,286,291,301,314,321,324,336,387,410],[8,15,17,37,52,55,58,75,95,115,121,145,152,168,170,178,183,189,192,209,212,233,243,250,260,262,273,278,280,283,306,316,327,329,334,348,355,378,405,412,418,427,428],[5,7,9,34,40,61,68,78,81,93,123,127,130,150,153,156,167,214,219,226,227,242,250,276,278,340,355,360,364,377,403,415,439,441,457,463,474],[1,4,14,16,21,43,58,62,81,98,111,124,145,153,178,181,202,206,229,264,266,284,304,310,319,330,412,427,459,464],[13,15,21,27,29,49,64,65,70,77,79,85,92,115,122,128,131,155,160,163,168,179,181,191,204,213,235,244,264,282,284,300,305,309,315,318,319,328,347,356,362,364,369,384,385,399,434,453],[0,5,14,15,21,22,26,30,35,38,40,53,60,62,79,93,100,104,108,116,117,126,127,129,147,151,152,155,159,161,163,172,174,176,190,194,205,216,228,230,236,250,253,256,271,274,278,283,298,316,320,329,335,337,342,346,350,353,356,361,365,368,369,371,379,380,390,392,402,404,409,412,415,422,424,427,428,433,436,449,450,458,461,467,468],[0,34,39,45,46,72,81,93,106,110,113,119,121,124,129,137,139,146,156,184,189,199,207,231,233,235,241,247,252,263,264,265,283,311,314,316,331,350,359,368,378,401,406,409,417,423,437,440,441,445,447,457,462,467],[0,9,20,28,36,37,39,48,54,64,71,73,75,76,84,109,119,121,122,131,139,155,175,186,205,206,211,213,218,220,222,228,239,242,244,254,265,278,285,286,295,301,321,329,335,344,346,349,350,359,370,371,372,384,393,397,398,408,412,433,435,436,442,458,460,464,466,468],[331,388,406],[5,43,68,73,89,110,131,199,214,245,272,279,290,305,331,359,388,392,413,435,470],[1,9,13,18,49,54,55,57,64,72,78,86,87,88,93,118,133,135,137,138,139,141,147,149,156,157,162,165,171,175,180,189,205,218,219,239,242,244,249,253,270,273,275,277,279,283,291,305,307,309,318,327,329,335,337,342,344,345,353,354,355,362,365,366,369,372,375,376,392,400,406,435,449,456,462,472],[5,6,19,22,39,49,51,53,66,76,79,80,86,98,122,134,138,142,157,165,167,168,179,180,198,204,215,237,243,246,248,254,257,285,288,290,295,318,319,326,338,347,355,361,375,376,380,386,388,390,396,402,403,404,427,437,441,459,472],[3,9,18,30,37,42,45,60,67,71,88,92,98,105,127,133,134,136,140,142,143,149,150,154,160,173,174,175,177,188,193,208,214,220,223,227,239,240,245,250,257,258,263,292,295,310,319,322,325,338,345,353,354,355,358,360,368,376,396,397,398,401,421,423,436,441,452,453,467,469,471],[3,58],[9,35,37,70,73,79,81,87,94,98,105,106,115,117,121,145,168,183,192,222,229,230,232,236,242,252,255,267,279,281,284,290,296,318,324,338,340,346,350,354,360,374,415,416,426,433,440,441,445,447,463,464],[7,11,16,22,25,32,34,38,39,45,57,58,64,66,68,69,73,79,85,88,91,96,101,114,120,125,131,139,142,149,152,165,170,172,174,176,192,194,208,211,218,221,230,236,240,263,271,281,284,288,294,310,318,324,325,329,336,340,341,346,348,351,355,361,369,370,376,385,389,397,401,415,417,418,419,423,429,443,465,466,468,473,474],[1,5,15,25,31,45,47,53,55,56,59,63,68,72,101,138,139,143,145,146,158,159,171,175,176,205,210,219,220,224,234,243,244,246,254,276,280,281,286,287,298,299,304,305,306,307,310,313,316,318,322,325,327,329,332,343,348,354,361,367,369,370,372,374,375,388,390,391,393,394,421,440,442,448,449,450,455,456,463,464,470,473],[32,70,89,91,100,130,147,157,166,182,205,251,269,280,289,301,305,315,333,338,354,366,374,388],[17,28,40,61,63,66,91,112,120,131,153,169,192,215,218,236,242,257,264,293,333,352,366,368,375,376,383,394,395,405,425,463],[27,28,61,73,79,80,89,94,95,99,119,125,128,131,156,165,177,193,197,198,205,209,212,218,219,224,230,231,232,247,253,258,269,271,276,277,281,282,290,291,301,316,319,341,346,347,351,354,361,386,399,402,422,438,454,471],[16,18,19,22,26,32,36,37,56,64,82,86,92,94,95,104,107,120,135,145,151,172,198,201,208,209,223,228,243,245,247,251,252,255,260,265,287,288,289,313,333,360,366,369,373,382,401,447,465],[1,4,7,21,27,28,30,34,41,58,63,65,78,92,93,95,100,104,110,111,115,131,132,136,145,148,158,175,180,186,191,194,195,196,200,204,206,215,227,228,242,243,245,246,251,258,274,279,288,289,292,295,300,304,306,312,323,325,329,335,340,342,345,365,370,387,393,409,414,418,424,434,457,462,466,471,472],[0,5,36,51,54,56,57,58,67,70,76,81,87,98,100,102,103,111,113,139,142,145,147,149,150,153,157,162,172,180,184,186,196,203,204,216,220,224,252,256,274,287,297,309,314,334,335,348,366,374,388,389,391,393,395,404,428,434,446,447,451,455,474],[22,58,81,98,100,107,125,133,199,224,230,232,235,288,290,323,324,340,351,393,397,399,446,451,461,468],[364],[0,1,10,12,16,35,37,45,58,60,61,79,83,90,96,119,127,133,136,139,141,143,144,167,170,177,178,182,192,207,212,216,230,234,256,284,293,298,314,317,321,329,354,357,362,367,369,376,420,434,438,439,441,442,443,452,456],[1,9,11,23,58,62,81,86,100,102,109,116,128,139,141,147,161,171,178,179,180,181,187,189,190,194,200,207,211,217,223,233,245,248,252,258,267,269,270,273,274,290,296,297,299,300,301,312,327,334,335,348,351,354,360,365,370,375,376,382,384,385,400,406,412,420,422,424,435,446,449,469,470,471],[0,10,11,13,15,17,35,38,40,61,63,75,76,78,109,113,115,120,123,129,130,134,144,148,156,158,159,161,176,179,186,199,204,205,209,211,237,244,246,251,256,268,274,290,297,299,300,316,317,327,336,338,348,353,366,369,375,380,383,386,387,394,398,405,411,423,427,430,435,436,440,441,447,455,459,463,467,469,471,472],[14,17,23,24,41,49,54,76,78,89,93,101,104,105,108,118,134,161,163,170,174,180,182,186,193,214,219,238,241,246,247,251,278,304,318,333,342,343,344,345,351,352,357,361,378,388,394,404,406,415,436,438,442,446,463,471],[8,12,17,21,42,48,50,52,74,80,104,117,124,127,138,146,147,153,162,167,176,207,215,219,220,231,235,240,252,268,285,290,291,302,320,321,328,334,353,356,371,372,374,387,402,415,419,448,450,459,466,473],[9,18,30,36,38,43,44,64,73,78,82,86,87,93,94,108,109,118,132,140,141,148,150,152,157,163,168,178,182,196,199,221,223,226,238,241,245,248,250,252,255,258,261,271,280,282,284,291,293,299,303,310,312,314,323,329,340,345,348,351,354,358,361,374,380,391,392,394,397,400,405,411,419,421,444,445,467],[11,20,21,43,44,47,55,59,62,68,69,74,80,81,84,92,93,97,112,115,119,121,123,127,129,130,150,155,157,161,163,164,165,169,179,180,182,189,194,197,205,221,223,236,241,249,257,260,262,265,271,281,286,290,292,296,297,304,305,307,321,323,334,349,357,363,365,368,382,396,401,408,416,439,453,454,455,464],[0,14,20,27,28,51,52,72,87,91,104,105,122,125,135,159,161,178,179,190,196,209,234,266,281,284,298,303,317,376,407,445,471,472],[2,27,81,142,158,178,258,276,332,438,443,472],[0,6,15,17,25,29,35,36,59,63,67,71,73,76,80,81,97,101,105,116,117,121,129,131,145,149,151,154,159,171,175,184,186,192,195,201,202,207,209,211,214,216,229,230,236,243,246,247,250,252,254,258,270,273,277,282,284,287,291,305,323,331,338,348,350,359,385,386,388,393,397,417,437,449,459,460,466,470,471,473],[1,12,14,15,26,35,36,50,63,67,68,70,73,79,99,110,121,122,128,135,136,140,148,149,160,188,196,200,203,204,206,210,213,218,225,227,228,233,243,244,246,254,258,265,267,283,286,290,296,308,311,312,317,326,330,338,343,364,365,369,381,383,399,402,403,420,421,422,427,430,433,437,438,443,445,447,459,460,462,467,469,470],[10,17,28,32,34,44,48,78,79,81,82,85,89,93,101,106,107,124,138,156,157,169,172,177,182,190,191,198,199,208,212,256,282,291,293,313,315,324,340,346,353,361,369,384,386,387,391,426,432,449,452,455,460,471],[15,25,48,66,69,78,83,87,113,116,123,137,143,147,159,199,204,232,235,242,247,251,265,266,294,314,321,324,351,356,362,363,376,390,401,433,434,444,445,448,473],[15,16,26,27,31,42,50,55,63,68,69,75,95,109,111,114,117,121,128,131,132,136,138,140,144,148,159,161,162,163,168,170,186,187,197,200,211,213,214,225,234,243,246,256,262,268,273,285,305,325,333,340,365,385,387,402,411,412,418,421,431,434,437,439,442,445,452,455,461],[6,7,16,22,44,45,47,53,73,77,80,81,111,119,120,122,126,129,133,134,140,143,144,146,147,150,170,172,186,189,197,199,210,224,226,228,240,244,246,249,250,255,272,274,276,280,283,300,303,305,308,311,312,313,324,325,326,330,333,341,347,355,362,369,375,385,391,413,421,423,430,432,438,446,450],[18,26,28,35,41,42,48,75,87,92,106,107,114,125,133,137,140,152,168,170,171,184,192,200,223,241,256,258,275,279,286,287,299,319,326,343,351,361,368,372,382,386,392,406,409,415,432,438,445,449,454,455,464,469],[8,10,20,29,30,36,37,39,42,46,48,66,69,71,72,76,78,83,84,85,95,108,112,117,120,124,132,133,148,152,177,180,185,189,231,232,246,247,260,267,279,284,291,303,314,316,320,331,333,335,341,346,350,369,392,397,401,408,410,413,414,416,422,426,439,444,459,462,463,466,469,470]],100,285)
